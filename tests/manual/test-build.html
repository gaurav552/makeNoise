<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MakeNoise Build Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .success {
      color: #28a745;
      font-weight: bold;
    }
    .error {
      color: #dc3545;
      font-weight: bold;
    }
    pre {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ðŸŽµ MakeNoise Build Test</h1>
  
  <div class="test-section">
    <h2>ESM Build Test</h2>
    <div id="esm-test">Testing...</div>
  </div>

  <div class="test-section">
    <h2>TypeScript Declarations Test</h2>
    <div id="types-test">Testing...</div>
  </div>

  <div class="test-section">
    <h2>Player Functionality Test</h2>
    <div id="player-test">Testing...</div>
  </div>

  <div class="test-section">
    <h2>Web Component Test</h2>
    <make-noise-player></make-noise-player>
  </div>

  <script type="module">
    import { MakeNoise, PlayerUIElement } from '../../dist/makenoise.js';

    // Test 1: ESM Build
    try {
      const esmTest = document.getElementById('esm-test');
      if (typeof MakeNoise === 'function') {
        esmTest.innerHTML = '<span class="success">âœ“ ESM build loaded successfully</span>';
      } else {
        esmTest.innerHTML = '<span class="error">âœ— ESM build failed - MakeNoise is not a function</span>';
      }
    } catch (error) {
      document.getElementById('esm-test').innerHTML = `<span class="error">âœ— ESM build failed: ${error.message}</span>`;
    }

    // Test 2: TypeScript Declarations (check if types are available)
    try {
      const typesTest = document.getElementById('types-test');
      const player = MakeNoise.getInstance();
      const state = player.getState();
      
      // Check if state has expected properties
      const hasExpectedProps = 
        typeof state.isPlaying === 'boolean' &&
        typeof state.volume === 'number' &&
        typeof state.repeatMode === 'string';
      
      if (hasExpectedProps) {
        typesTest.innerHTML = '<span class="success">âœ“ TypeScript types working correctly</span>';
      } else {
        typesTest.innerHTML = '<span class="error">âœ— TypeScript types missing expected properties</span>';
      }
    } catch (error) {
      document.getElementById('types-test').innerHTML = `<span class="error">âœ— Types test failed: ${error.message}</span>`;
    }

    // Test 3: Player Functionality
    try {
      const playerTest = document.getElementById('player-test');
      const player = MakeNoise.getInstance();
      
      // Test adding a track
      const testTrack = {
        id: 'test-1',
        src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
        title: 'Test Track',
        artist: 'Test Artist'
      };
      
      player.addTrack(testTrack);
      const playlist = player.getPlaylist();
      
      if (playlist.length > 0 && playlist[0].id === 'test-1') {
        playerTest.innerHTML = `
          <span class="success">âœ“ Player functionality working</span>
          <pre>${JSON.stringify(player.getState(), null, 2)}</pre>
        `;
      } else {
        playerTest.innerHTML = '<span class="error">âœ— Player functionality failed</span>';
      }
    } catch (error) {
      document.getElementById('player-test').innerHTML = `<span class="error">âœ— Player test failed: ${error.message}</span>`;
    }

    // Test 4: Web Component
    setTimeout(() => {
      const webComponent = document.querySelector('make-noise-player');
      if (webComponent && webComponent.shadowRoot) {
        console.log('âœ“ Web Component loaded successfully');
      } else {
        console.error('âœ— Web Component failed to load');
      }
    }, 100);
  </script>
</body>
</html>
